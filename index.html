<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#111111" />
  <link rel="manifest" href="manifest.webmanifest" />
  <link rel="stylesheet" href="style.css" />
  <title>BassCoach</title>
</head>
<body>
<div id="appRoot">
  <header>
    <h1>BassCoach</h1>
    <div class="row">
      <button id="btnStartAudio">Enable Mic</button>
      <span id="micStatus" class="badge">Mic: off</span>
      <span id="jsStatus" class="badge">JS: …</span>
      <script>document.getElementById("jsStatus").textContent="JS: inline";</script>
      <span id="noteReadout" class="badge">—</span>
    </div>
    <nav class="tabs">
      <button class="tab active" data-tab="tuner">Tuner</button>
      <button class="tab" data-tab="practice">Practice (MIDI)</button>
      <button class="tab" data-tab="library">Library</button>
      <button class="tab" data-tab="about">About</button>
    </nav>

    <div class="row">
      <label class="small">
        Sensitivity:
        <input id="sens" type="range" min="0" max="100" value="55" />
      </label>
      <span id="levelReadout" class="badge">Level: —</span>
      <div class="levelbar"><div id="inputMeter"></div></div>
    </div>
    <div class="row">
      <label class="small">
        Mic device:
        <select id="micDevice"></select>
      </label>
    </div>

  </header>

  <noscript>
    <div style="margin:12px 14px;padding:12px;border:1px solid #333;border-radius:12px;background:#1a1a1a;color:#fff;">
      JavaScript is disabled. BassCoach requires JavaScript to run. On iPhone: Settings → Safari → Advanced → JavaScript → ON.
    </div>
  </noscript>


  <main>
    <section id="tab-tuner" class="panel active">
      <div class="card">
        <h2>Tuner</h2>
        <div class="tuner">
          <div class="big" id="tunerNote">—</div>
          <div class="small" id="tunerHz">— Hz</div>
          <div class="meter">
            <div id="meterNeedle"></div>
          </div>
          <div class="small" id="tunerCents">— cents</div>
          <div class="subcard">
            <div class="small dim">Suggested position</div>
            <div class="pos" id="tunerPos">—</div>
            <div class="small dim" id="tunerAlt"> </div>
          </div>
          <div class="hint">Tip: Headphones or low speaker volume helps avoid feedback.</div>
        </div>
      </div>

      <div class="card">
        <h3>4‑string bass open strings (standard)</h3>
        <ul>
          <li>E1 (41.20 Hz)</li>
          <li>A1 (55.00 Hz)</li>
          <li>D2 (73.42 Hz)</li>
          <li>G2 (98.00 Hz)</li>
        </ul>
      </div>
    </section>

    <section id="tab-practice" class="panel">
      <div class="card">
        <h2>Practice (MIDI)</h2>
        <div class="row">
          <label class="small">MIDI file:
            <input id="midiFile" type="file" accept=".mid,.midi" />
          </label>
          <label class="small">Song audio (mp3/wav):
            <input id="audioFile" type="file" accept="audio/*" />
          </label>
          <button id="btnPlay">Play</button>
          <button id="btnPause">Pause</button>
          <button id="btnStop">Stop</button>
        </div>
        <div class="row">
          <label class="small">
            Hit window (ms):
            <input id="hitWindow" type="number" min="50" max="500" value="180" />
          </label>
          <label class="small">
            Min confidence:
            <input id="minConf" type="number" min="0" max="1" step="0.05" value="0.55" />
          </label>
          <label class="small">
            Max fret:
            <input id="maxFret" type="number" min="12" max="24" value="20" />
          </label>
        
        </div>
        <div class="row">
          <label class="small">
            Speed:
            <input id="speed" type="range" min="25" max="200" value="100" />
          </label>
          <span id="speedReadout" class="badge">1.00×</span>
          <label class="small">
            View:
            <select id="viewMode">
              <option value="piano" selected>Piano Roll</option>
              <option value="tab">Bass Tab (4 strings)</option>
              <option value="gh">Guitar Hero (vertical)</option>
            </select>
          </label>

          <label class="small">
            Song sync (sec):
            <input id="syncOffset" type="number" step="0.05" value="0.00" />
          </label>
          <label class="small">
            Play audio:
            <input id="playAudio" type="checkbox" checked />
          </label>

          <label class="small">
            UI scale:
            <input id="uiScale" type="range" min="70" max="130" value="100" />
          </label>
          <span id="uiScaleReadout" class="badge">100%</span>


          <label class="small">
            Bass‑only:
            <input id="bassOnly" type="checkbox" checked />
          </label>
          <label class="small">
            Lowest only:
            <input id="lowestOnly" type="checkbox" checked />
          </label>
        </div>

        
        <div class="row">
          <button id="btnRestart">Restart</button>
          <button id="btnSetA">Set A</button>
          <button id="btnSetB">Set B</button>
          <label class="small">
            Loop A–B:
            <input id="loopOn" type="checkbox" />
          </label>
          <span id="loopReadout" class="badge">A: —  B: —</span>
        </div>

        <div class="canvasWrap">
          <canvas id="lane" width="900" height="440"></canvas>
        </div>
        <div class="small" id="practiceStatus">Load a MIDI file to begin.</div>
      </div>
    </section>

    <section id="tab-library" class="panel" hidden>
      <h2>MIDI Library</h2>
      <p class="small">Upload multiple MIDI files once, then load them anytime from this device/browser.</p>

      <div class="row">
        <label class="small">
          Add MIDI files:
          <input id="libAddFiles" type="file" accept=".mid,.midi" multiple />
        </label>
        <button id="libClear">Clear library</button>
      </div>

      <div class="row">
        <label class="small">
          Search:
          <input id="libSearch" type="text" placeholder="type to filter…" />
        </label>
        <span class="badge" id="libCount">0 songs</span>
      </div>

      <div class="card" style="padding:12px">
        <div id="libList" class="libList"></div>
      </div>

      <p class="small hint">Tip: Library is stored locally (IndexedDB). Clearing site data will remove it.</p>
    </section>


    <section id="tab-about" class="panel">
      <div class="card">
        <h2>About</h2>
        <p>
          BassCoach is a free, offline‑capable PWA that listens through your microphone and estimates the note you’re playing in real time.
          Practice mode lets you upload a MIDI file and play along with live HIT/MISS feedback.
        </p>
        <p class="small">
          iPhone Safari requires a tap to start audio. Pitch detection is best with a clean signal (quiet room, or an audio interface).
        </p>
      </div>
    </section>
  </main>

  <footer class="small">
    <span>Client‑side only • No accounts • No paid APIs</span>
  </footer>

  <script type="module" src="app.js"></script>
  <script nomodule src="legacy.js"></script>
</div>
</body>
</html>

<div id="buildBadge" class="badge">Build v18 • 2025-12-26 21:51 UTC</div>
